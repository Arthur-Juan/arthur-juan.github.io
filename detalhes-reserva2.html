<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes da Reserva</title>
    <style>
        body {
            background-color: #ffffff;
            color: #e74c3c;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    

        .container {
            width: 80%;
            margin: 20px auto;
        }

        .info-container {
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #dddddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        p {
            margin-bottom: 16px;
            color: #000000;
        }

        .back-button {
            background-color: #e74c3c;
            color: #ffffff;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin-top: 20px;
        }

        .back-button:hover {
            background-color: #c0392b;
        }

        .actions{
            display: grid;
        }

        .glider.draggable .glider-slide img{
            height: 150px;
        }
    </style>
      <meta content="" name="description">
      <meta content="" name="keywords">
    
      <!-- Favicons -->
      <link href="assets/img/favicon.png" rel="icon">
      <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
    
      <!-- Google Fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Amatic+SC:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    
      <!-- Vendor CSS Files -->
      <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
      <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
      <link href="assets/vendor/aos/aos.css" rel="stylesheet">
      <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
      <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/glider-js/1.7.8/glider.min.js"
        integrity="sha512-AZURF+lGBgrV0WM7dsCFwaQEltUV5964wxMv+TSzbb6G1/Poa9sFxaCed8l8CcFRTiP7FsCgCyOm/kf1LARyxA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/glider-js/1.7.8/glider.min.css"
        integrity="sha512-YM6sLXVMZqkCspZoZeIPGXrhD9wxlxEF7MzniuvegURqrTGV2xTfqq1v9FJnczH+5OGFl5V78RgHZGaK34ylVg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link href="assets/css/main.css" rel="stylesheet">

</head>

<body>

     <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-lg-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1>Al-Mosso<span>.</span></h1>
      </a>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="#hero">Home</a></li>
          <li><a href="#about">Sobre</a></li>
          <li><a href="#menu">Menu</a></li>
          <li><a href="#chefs">Chefs</a></li>
         
          <li><a href="#contact">Contato</a></li>
        </ul>
      </nav><!-- .navbar -->

      <a class="btn-book-a-table" href="#book-a-table">Reserve já</a>
      <a href="/detalhes-reserva2.html" class="login-button">Ver reserva</a>
      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>

    </div>
  </header><!-- End Header -->

  <main id="main">
    <input type="hidden" value="" id="pin">
    <div class="container">
        <div class="info-container">
            <label for="nome">Nome:</label>
            <p id="nome">Nome do Cliente</p>

            <label for="email">Email:</label>
            <p id="email">email@exemplo.com</p>

            <label for="telefone">Telefone:</label>
            <p id="telefone">(00) 1234-5678</p>

            <label for="data">Data:</label>
            <p id="data">01/01/2023</p>

            <label for="comeco">Começo:</label>
            <p id="comeco">18:00</p>

            <label for="fim">Fim:</label>
            <p id="fim">20:00</p>

            <label for="quantidade">Quantidade de pessoas:</label>
            <p id="quantidade">4</p>

            <label for="price">Preço (R$ 25 de valor base):</label>
            <p id="price"></p>

            <div class="glider-contain">
                <div class="glider">
                </div>

                <button aria-label="Previous" class="glider-prev">«</button>
                <button aria-label="Next" class="glider-next">»</button>
                <div role="tablist" class="dots"></div>
            </div>

            <a href="#" class="back-button">Ver outra Reserva</a>
        </div>
    </div>
</main>



    <script>



    </script>


    <script src="assets/js/index.js"></script>

    <script>


        function createCard(food) {
            const card = document.createElement('div');
            card.className = 'card';
            card.style = 'width: 18rem;';
            card.innerHTML = `
            <img src="http://localhost:8080/${food.ProfilePic.replace("./", "")}" class="card-img-top" alt="${food.Name}">
            <div class="card-body">
                <h5 class="card-title">${food.Name}</h5>
                <p class="card-text">${food.Description}</p>
                <p class="card-text">Price: R$ ${food.Price}</p>
                <div class="actions">
                <button  data-id="${food.ID}" class="btn btn-primary detalhe">Ver detalhe</button>
                <button  data-id="${food.ID}" class="btn btn-danger remover">Remover da reserva</button>
                </div>
            </div>
        `;
            return card;
        }


        let token = localStorage.getItem("token")

        if (token) {
            // URL of the API endpoint
            const apiUrl = 'http://localhost:8080/api/v1/appointments';

            // Make a GET request with the token in the headers
            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                    // You may need to add other headers based on your API requirements
                },
            })
                .then(response => {
                    // Check if the request was successful (status code 2xx)
                    if (response.ok) {
                        return response.json(); // Parse the response body as JSON
                    } else {
                        throw new Error(`Request failed with status: ${response.status}`);
                    }
                })
                .then(data => {
                    console.log('Data received:', data);

                    document.getElementById('nome').textContent = data.client.Name;
                    document.getElementById('email').textContent = data.client.Email;
                    document.getElementById('telefone').textContent = data.client.Phone;

                    // Format date
                    const formattedDate = new Date(data.date).toLocaleDateString();
                    document.getElementById('data').textContent = formattedDate;

                    // Format start and end times
                    const formattedStartTime = new Date(data.start).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    const formattedEndTime = new Date(data.end).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    document.getElementById('comeco').textContent = formattedStartTime;
                    document.getElementById('fim').textContent = formattedEndTime;

                    document.getElementById('quantidade').textContent = data.people_qtd;

                    document.querySelector("#price").textContent = ` R$ ${data.price}`;
                    document.querySelector("#pin").value = data.PIN

                    data.foods.forEach(food => {
                        let card = createCard(food);
                        document.querySelector(".glider").appendChild(card)
                    });

                    let remover = document.querySelectorAll(".remover");
                    remover.forEach(item => {

                        item.addEventListener("click", ()=>{
                            // console.log(item.dataset.id)

                            let pin = document.querySelector("#pin").value;
                            let food_id = item.dataset.id;

                            fetch(`http://localhost:8080/api/v1/appointments/${pin}/remove_food`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${token}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    food_id: parseInt(food_id)
                                })
                            }).then(() =>{
                                location.reload()
                            }).catch( err =>{
                                alert("Erro inesperado")
                            } )
                        });


                    });

                    let detalhe = document.querySelectorAll(".detalhe");
                    detalhe.forEach(item => {
                        item.addEventListener('click', ()=>{
                            window.location = "detail.html?id="+item.dataset.id
                        });

                    })

                    new Glider(document.querySelector('.glider'), {
                        slidesToShow: 5,
                        slidesToScroll: 5,
                        draggable: true,
                        dots: '.dots',
                        arrows: {
                            prev: '.glider-prev',
                            next: '.glider-next'
                        }
                    })
                    return data;
                })
                .catch(error => {
                    // Handle errors during the fetch
                    console.error('Fetch error:', error);
                });
        } else {
            window.location = "/login-form/login-al-mosso.html";

        }


    </script>


    <script>



    </script>

</body>

</html>